class PostComments{constructor(e){this.postId=e,this.postContainer=$(`#post-${e}`),this.newCommentForm=$(`#post-${e}-comments-form`),this.firstCommentContainer=$(`#${e}-first-comment`),this.remCommentContainer=$(`#${e}-comments-all`),this.createComment(e);let t=this;$(".delete-comment-btn",this.postContainer).each((function(){t.deleteComment($(this))}))}createComment(e){let t=this;this.newCommentForm.submit((function(n){n.preventDefault();""!=t.newCommentForm[0][0].value&&t.newCommentForm[0][0].value.trim()?$.ajax({type:"post",url:"/comments/create",data:$(this).serialize(),success:function(n){let a=t.getCommentDom(n.data.comment,n.data.post,n.data.locals);if(1==n.data.post.comments.length)t.firstCommentContainer.prepend(a);else if(n.data.post.comments.length>1){let o=t.firstCommentContainer[0].firstElementChild;t.remCommentContainer.prepend(o),t.firstCommentContainer.html(a),$(".delete-comment-btn",t.postContainer).each((function(){t.deleteComment($(this))})),$(`.card-footer-${e}`).removeClass("d-none"),$(`.card-footer-${e} > p > a`).html(`Load More Comments (${n.data.post.comments.length-1})`)}t.newCommentForm[0].reset(),t.deleteComment($(`#delete-${n.data.comment._id}-comment`)),new Noty({theme:"relax",text:"Comment published!",type:"success",layout:"topRight",timeout:1500}).show()},error:function(e){console.log(e.responseText)}}):new Noty({theme:"relax",text:"Comment cannot be empty",type:"error",layout:"topRight",timeout:1500}).show()}))}getCommentDom(e,t,n){return`\n      \x3c!-- Comment item START --\x3e\n      <li class="comment-item mb-3" id="comment-${e._id}">\n        <div class="d-flex ithcomment">\n          \x3c!-- Avatar --\x3e\n          <div class="avatar avatar-xs">\n            <a href="#!">\n              <img class="avatar-img rounded-circle" src="${e.user.avatar?e.user.avatar:assetPath("images/default-avatar.png")}" alt="${e.user.name}" />\n            </a>\n          </div>\n          \x3c!-- Comment by --\x3e\n          <div class="ms-2 w-100">\n            <div class="bg-light p-3 rounded">\n              <div class="d-flex flex-column">\n                <div class="d-flex align-items-center w-100">\n                  <h6 class="mb-1 card-title d-flex flex-wrap gap-1 align-items-center justify-content-between flex-grow-1">\n                    <a href="#!"> ${e.user.name} </a>\n                    <div class="text-muted  small ps-0  time-posted">\n                      ${getTimePosted(e.createdAt)}\n                    </div>\n                  </h6>\n                  <div class="dropdown ms-1">\n                    <a href="#" class="text-secondary btn btn-secondary-soft-hover py-1 px-2 commentAction" id="commentAction-${e._id}" data-bs-toggle="dropdown" aria-expanded="false">\n                      <i class="fa fa-ellipsis-h text-muted"></i>\n                    </a>\n                    \x3c!-- Card feed action dropdown menu --\x3e\n                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="commentAction-${e._id}">\n                      ${n.user&&n.user.id==e.user.id?`<li>\n                        <a class="dropdown-item" href="/comments/destroy/${e._id}">\n                          <i class="fa fa-edit fa-fw pe-2"></i>\n                          Edit Comment\n                        </a>\n                      </li>\n                      <li>\n                        <a class="dropdown-item delete-comment-btn" href="/comments/destroy/${e._id}" id="delete-${e._id}-comment">\n                          <i class="fa fa-trash fa-fw pe-2"></i>\n                          Delete Comment\n                        </a>\n                      </li>`:n.user?`<li>\n                        <a class="dropdown-item" href="#">\n                          <i class="fa fa-user fa-fw pe-2"></i>\n                          Unfollow\n                          <strong class="text-capitalize">\n                            ${e.user.name}\n                          </strong>\n                        </a>\n                      </li>\n                      <li>\n                        <a class="dropdown-item" href="#">\n                          <i class="fa fa-flag fa-fw pe-2"></i>\n                          Report Comment</a>\n                      </li>`:""}\n                    </ul>\n                  </div>\n                </div>\n                <p class="small mb-0">${e.content}</p>\n              </div>\n            </div>\n            <div class="d-flex align-items-center mt-1 share">\n              ${n.user?`\n                <a href="/likes/toggle/?id=${e._id}&type=Comment" class="text-secondary small me-3 toggle-like-button" data-likes="${e.likes.length}">\n                    ${e.likes.find((e=>e.user._id.toString()==n.user._id.toString()))?`<span class="liked">\n                            <i class="fa fa-thumbs-up fa-fw me-1"></i>\n                            Liked (${e.likes.length})\n                          </span>`:` <span>\n                              <i class="fa fa-thumbs-up fa-fw me-1"></i>\n                              Like (${e.likes.length})\n                            </span>`}\n                </a>\n                <a class="text-secondary small me-2 d-flex align-items-center" data-bs-toggle="collapse" href="#${e._id}-reply" role=" button" aria-expanded="false" aria-controls="collapseExample">\n                  <i class="fa fa-comment fa-fw me-1"></i>\n                  Reply\n                </a>\n                <div>\n                  <span class="ms-1 badge bg-secondary rounded-pill p-auto">\n                    <span class="d-none d-lg-inline-block">Replies</span>\n                    ${e.replies.length}\n                  </span>\n                </div>`:`<div class="text-secondary fw-bold small me-3">\n                      <i class="fa fa-thumbs-up fa-fw me-1"></i>\n                      Likes (${e.likes.length})\n                    </div>\n                    <a class="text-secondary small me-3" href="/login">\n                      Replies (${e.replies.length})\n                    </a>`}\n            </div>\n          </div>\n        </div>\n\n        ${n.user?`\x3c!-- Add comment --\x3e\n              <div id="${e._id}-reply" class="collapse ms-5">\n                <div class="d-flex mt-2 mb-2">\n                  \x3c!-- Avatar --\x3e\n                  <div class="avatar avatar-xs me-2">\n                    <a href="#!">\n                      <img class="avatar-img rounded-circle" src="${n.user.avatar}" alt="avatar" />\n                    </a>\n                  </div>\n                  \x3c!-- Comment box  --\x3e\n                  <form class="nav nav-item w-100 position-relative" action="/comments/create-reply" method="POST" id="comment-${e._id}-reply-form">\n                    <input type="text" name="content" id="reply-input-${e._id}"\n                    class="form-control rounded-pill bg-transparent border-0 reply-input" placeholder="Write a comment " />\n                    <input type="hidden" name="post" value="${t._id}" />\n                    <input type="hidden" name="comment" value="${e._id}" />\n                    <button class="nav-link bg-transparent px-3 position-absolute top-50 end-0 translate-middle-y border-0 add-reply" type="submit" id="add-reply-${e._id}">\n                      <i class="fa fa-paper-plane"></i>\n                    </button>\n                  </form>\n                </div>\n              </div>`:""} \n           \n      </li>\n      \x3c!-- Comment item END --\x3e\n      `}deleteComment(e){let t=this;$(e).click((function(n){n.preventDefault(),$.ajax({type:"get",url:$(e).prop("href"),success:function(e){if(1==e.data.commentlen)$(`#comment-${e.data.comment_id}`).remove();else if(2==e.data.commentlen)if(t.firstCommentContainer.find(`#comment-${e.data.comment_id}`).length>0){$(`#comment-${e.data.comment_id}`).remove();let n=t.remCommentContainer.html();t.remCommentContainer.html(""),t.firstCommentContainer.html(n),$(".delete-comment-btn",t.postContainer).each((function(){t.deleteComment($(this))})),$(`.card-footer-${e.data.postId} > p > a`).html(`Load More Comments (${e.data.commentlen-2})`),$(`.card-footer-${e.data.postId}`).addClass("d-none")}else t.remCommentContainer.html(""),$(`.card-footer-${e.data.postId}`).addClass("d-none");else if(e.data.commentlen>2)if(t.firstCommentContainer.find(`#comment-${e.data.comment_id}`).length>0){$(`#comment-${e.data.comment_id}`).remove(),$(".delete-comment-btn",t.postContainer).each((function(){t.deleteComment($(this))}));let n=t.remCommentContainer[0].firstElementChild;t.remCommentContainer[0].firstElementChild.remove(),t.firstCommentContainer.html(n),$(`.card-footer-${e.data.postId} > p > a`).html(`Load More Comments (${e.data.commentlen-2})`)}else $(`#comment-${e.data.comment_id}`).remove(),$(`.card-footer-${e.data.postId} > p > a`).html(`Load More Comments (${e.data.commentlen-2})`);new Noty({theme:"relax",text:"Comment Deleted !!",type:"success",layout:"topRight",timeout:1500}).show()},error:function(e){console.log(e.responseText)}})}))}}