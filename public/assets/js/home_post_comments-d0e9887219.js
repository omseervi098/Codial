function PostComments(e){let t={postId:e,postContainer:$(`#post-${e}`),newCommentForm:$(`#post-${e}-comments-form`),firstCommentContainer:$(`#${e}-first-comment`),remCommentContainer:$(`#${e}-comments-all`),commentcnt:$(`#commentcnt-${e}`)},n=function(e,t,n){return`\n      \x3c!-- Comment item START --\x3e\n      <li class="comment-item mb-3" id="comment-${e._id}">\n        <div class="d-flex ithcomment">\n          \x3c!-- Avatar --\x3e\n          <div class="avatar avatar-xs">\n            <a href="#!">\n              <img class="avatar-img rounded-circle" src="${e.user.avatar?e.user.avatar:assetPath("images/default-avatar.png")}" alt="${e.user.name}" />\n            </a>\n          </div>\n          \x3c!-- Comment by --\x3e\n          <div class="ms-2 w-100">\n            <div class="bg-light p-3 rounded">\n              <div class="d-flex flex-column">\n                <div class="d-flex align-items-center w-100">\n                  <h6 class="mb-1 card-title d-flex flex-wrap gap-1 align-items-center justify-content-between flex-grow-1">\n                    <a href="#!"> ${e.user.name} </a>\n                    <div class="text-muted  small ps-0  time-posted">\n                      ${getTimePosted(e.createdAt)}\n                    </div>\n                  </h6>\n                  <div class="dropdown ms-1">\n                    <a href="#" class="text-secondary btn btn-secondary-soft-hover py-1 px-2 commentAction" id="commentAction-${e._id}" data-bs-toggle="dropdown" aria-expanded="false">\n                      <i class="fa fa-ellipsis-h text-muted"></i>\n                    </a>\n                    \x3c!-- Card feed action dropdown menu --\x3e\n                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="commentAction-${e._id}">\n                      ${n.user&&n.user.id==e.user.id?`<li>\n                        <a class="dropdown-item" href="/comments/destroy/${e._id}">\n                          <i class="fa fa-edit fa-fw pe-2"></i>\n                          Edit Comment\n                        </a>\n                      </li>\n                      <li>\n                        <a class="dropdown-item delete-comment-btn" href="/comments/destroy/${e._id}" id="delete-${e._id}-comment">\n                          <i class="fa fa-trash fa-fw pe-2"></i>\n                          Delete Comment\n                        </a>\n                      </li>`:n.user?`<li>\n                        <a class="dropdown-item" href="#">\n                          <i class="fa fa-user fa-fw pe-2"></i>\n                          Unfollow\n                          <strong class="text-capitalize">\n                            ${e.user.name}\n                          </strong>\n                        </a>\n                      </li>\n                      <li>\n                        <a class="dropdown-item" href="#">\n                          <i class="fa fa-flag fa-fw pe-2"></i>\n                          Report Comment</a>\n                      </li>`:""}\n                    </ul>\n                  </div>\n                </div>\n                <p class="small mb-0">${e.content}</p>\n              </div>\n            </div>\n            <div class="d-flex align-items-center mt-1 share">\n              ${n.user?`\n                <a href="/likes/toggle/?id=${e._id}&type=Comment" class="text-secondary small me-3 toggle-like-button" data-likes="${e.likes.length}">\n                    ${e.likes.find((e=>e.user._id.toString()==n.user._id.toString()))?`<span class="liked">\n                            <i class="fa fa-thumbs-up fa-fw me-1"></i>Liked (${e.likes.length})\n                          </span>`:` <span>\n                              <i class="fa fa-thumbs-up fa-fw me-1"></i>Like (${e.likes.length})\n                            </span>`}\n                </a>\n                <a class="text-secondary small me-2 d-flex align-items-center" data-bs-toggle="collapse" href="#${e._id}-reply" role=" button" aria-expanded="false" aria-controls="collapseExample">\n                  <i class="fa fa-comment fa-fw me-1"></i>\n                  Reply\n                </a>\n                <div>\n                  <span class="ms-1 badge bg-secondary rounded-pill p-auto" id="replycnt-${e._id}">\n                    <span class="d-none d-lg-inline-block">Replies</span>\n                    ${e.replies.length}\n                  </span>\n                </div>`:`<div class="text-secondary fw-bold small me-3">\n                      <i class="fa fa-thumbs-up fa-fw me-1"></i>Likes (${e.likes.length})\n                    </div>\n                    <a class="text-secondary small me-3" href="/login">Replies (${e.replies.length})\n                    </a>`}\n            </div>\n          </div>\n        </div>\n\n        ${n.user?`\x3c!-- Add comment --\x3e\n              <div id="${e._id}-reply" class="collapse ms-5">\n                <div class="d-flex mt-2 mb-2">\n                  \x3c!-- Avatar --\x3e\n                  <div class="avatar avatar-xs me-2">\n                    <a href="#!">\n                      <img class="avatar-img rounded-circle" src="${n.user.avatar}" alt="avatar" />\n                    </a>\n                  </div>\n                  \x3c!-- Comment box  --\x3e\n                  <form class="nav nav-item w-100 position-relative" action="/comments/create-reply" method="POST" id="comment-${e._id}-${t._id}-reply-form">\n                    <input type="text" name="content" id="reply-input-${e._id}"\n                    class="form-control rounded-pill bg-transparent border-0 reply-input" placeholder="Write a comment " />\n                    <input type="hidden" name="post" value="${t._id}" />\n                    <input type="hidden" name="comment" value="${e._id}" />\n                    <button class="nav-link bg-transparent px-3 position-absolute top-50 end-0 translate-middle-y border-0 add-reply" type="submit" id="add-reply-${e._id}">\n                      <i class="fa fa-paper-plane"></i>\n                    </button>\n                  </form>\n                </div>\n              </div>`:""} \n        <ul class="pt-2 pb-0 list-unstyled ms-5" id="comment-${e._id}-${t._id}-reply-list">\n          \n        </ul>\n      </li>\n      \x3c!-- Comment item END --\x3e\n      `},a=function(e){let n=t;$(e).click((function(o){o.preventDefault(),$.ajax({type:"GET",url:$(e).prop("href"),success:function(e){if(1==e.data.commentlen)$(`#comment-${e.data.comment_id}`).remove();else if(2==e.data.commentlen)if(n.firstCommentContainer.find(`#comment-${e.data.comment_id}`).length>0){$(`#comment-${e.data.comment_id}`).remove();let t=n.remCommentContainer.html();n.remCommentContainer.html(""),n.firstCommentContainer.html(t);let o=n.firstCommentContainer[0].firstElementChild.id.split("-")[1];replyPostComment(n.postId,o),$(".delete-comment-btn",n.postContainer).each((function(){a($(this,n.postContainer))})),$(".toggle-like-button",n.firstCommentContainer).each((function(){new ToggleLike($(this))})),$(`.card-footer-${e.data.postId} > p > a`).html(`Load More Comments (${e.data.commentlen-2})`),$(`.card-footer-${e.data.postId}`).addClass("d-none")}else n.remCommentContainer.html(""),$(`.card-footer-${e.data.postId}`).addClass("d-none");else if(e.data.commentlen>2)if(n.firstCommentContainer.find(`#comment-${e.data.comment_id}`).length>0){$(`#comment-${e.data.comment_id}`).remove(),$(".delete-comment-btn",n.postContainer).each((function(){a($(this,n.postContainer))}));let t=n.remCommentContainer[0].firstElementChild;n.remCommentContainer[0].firstElementChild.remove(),n.firstCommentContainer.html(t),$(`.card-footer-${e.data.postId} > p > a`).html(`Load More Comments (${e.data.commentlen-2})`)}else $(`#comment-${e.data.comment_id}`).remove(),$(`.card-footer-${e.data.postId} > p > a`).html(`Load More Comments (${e.data.commentlen-2})`);t.commentcnt.html(`<i class="fa fa-comment pe-1"></i> Comment (${e.data.commentlen-1})`),new Notification("Comment deleted !!!","success"),socket.emit("delete_comment",{data:{comment_id:e.data.comment_id,comment:e.data.comment,post:e.data.post,commentlen:e.data.commentlen,postId:e.data.postId}})},error:function(e){console.log(e.responseText),new Notification("Error in deleting comment !!!","danger")}})}))};t.newCommentForm.submit((function(o){o.preventDefault(),""!=t.newCommentForm[0][0].value&&t.newCommentForm[0][0].value.trim()?(t.newCommentForm.attr("disabled",!0),$.ajax({type:"post",url:"/comments/create",data:$(this).serialize()}).done((function(o){let m=n(o.data.comment,o.data.post,o.data.locals);if(1==o.data.post.comments.length)t.firstCommentContainer.prepend(m),new ToggleLike($(".toggle-like-button",t.firstCommentContainer)),replyPostComment(t.postId,o.data.comment._id);else if(o.data.post.comments.length>1){let n=t.firstCommentContainer[0].firstElementChild;t.remCommentContainer.prepend(n),t.firstCommentContainer.html(m),$(".toggle-like-button",t.firstCommentContainer).each((function(){new ToggleLike($(this))})),replyPostComment(t.postId,o.data.comment._id),$(".delete-comment-btn",t.postContainer).each((function(){a($(this))})),$(`.card-footer-${e}`).removeClass("d-none"),$(`.card-footer-${e} > p > a`).html(`Load More Comments (${o.data.post.comments.length-1})`)}t.commentcnt.html(`<i class="fa fa-comment pe-1"></i> Comment (${o.data.post.comments.length})`),t.newCommentForm[0].reset(),a($(`#delete-${o.data.comment._id}-comment`)),new Notification("Comment published !!!","success"),t.newCommentForm.attr("disabled",!1),socket.emit("new_comment",{comment:o.data.comment,post:o.data.post})})).fail((function(e){console.log(e.responseText),new Notification("Error in publishing comment !!!","danger")}))):new Notification("Comment cannot be empty !!","warning")})),$(".delete-comment-btn",t.postContainer).each((function(){a($(this))})),$(`#${e}-first-comment > .comment-item`).each((function(){let t=$(this).attr("id").split("-")[1];replyPostComment(e,t)})),$(`#${e}-comments-all > .comment-item`).each((function(){let t=$(this).attr("id").split("-")[1];replyPostComment(e,t)}))}