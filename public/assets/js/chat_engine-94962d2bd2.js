let selfUser,userMail,otherUser,currentChatRoom,chatArea=$("#chatbox"),roomList=[];var socket=io.connect("http://localhost:5000");function joinRoom(){socket.emit("join_room",{user_email:userMail,chatroom:currentChatRoom}),socket.on("user_joined",(function(e){console.log("New User Joined",e)}))}socket.on("connect",(function(){console.log("connection established using sockets...!")}));var sendMessage=()=>{function e(){let e=$(".chat-input"),s=e.val();""!=s&&(socket.emit("send_message",{message:s,user_id:selfUser._id,user_email:userMail,chatroom:currentChatRoom}),e.val(""))}$(".message-send").submit(e),$(".chat-input").keydown((function(s){"Enter"!==s.key||s.shiftKey||e()}))};function connectRoom(){roomList.includes(currentChatRoom)||(joinRoom(),roomList.push(currentChatRoom)),sendMessage()}function createArea(e,s,n){return`<div class="chatbox-holder">\n    <div class="chatbox">\n        <div class="chatbox-top">\n            <div class="chatbox-avatar">\n                <a >\n                ${s.avatar?`<img src="${s.avatar}" />`:'<img src="/images/default-avatar.png" />'}\n                </a>\n            </div>\n            <div class="chat-partner-name">\n                <span class="status online"></span>\n                <a>${s.name}</a>\n            </div>\n            \n            <div class="chatbox-icons">\n                <i onclick="minimize()" class="fa fa-minus"></i>\n                <i onclick="hide()" class="fa fa-close"></i>\n            </div>\n            </div>\n            <div class="chat-messages" id="chat-messages-list-${e._id}">\n            ${e.messages.map((e=>""+(e.user===n._id?`<div class="message-box-holder">\n                       <div class="message-box">\n                           ${e.message}\n                        </div>\n                        </div>`:`\n                    <div class="message-box-holder">\n                        <div class="message-sender">\n                            ${s.name}\n                        </div>\n                        <div class="message-box message-partner">\n                            ${e.message}\n                        </div>\n                    </div>`))).join("")}\n        </div>\n        <div class="chat-input-holder">\n            <input type="text" class="chat-input" placeholder="Type Here..."></input>\n            <input type="submit" value="Send" class="message-send" />\n        </div>\n    \n    </div>`}function minimize(){console.log("clicked"),$(".chatbox").toggleClass("chatbox-min")}function hide(){$("#chatbox").css("display","none"),$(".chatbox").hide()}function arrow(){$(".back-button").click((()=>{$("#chatbox").css("display","none"),$("#chatbox").css({display:"block",width:"100%"})}))}function changeScreen(){window.innerWidth<=430&&($("#chatbox").css({display:"block",width:"100%"}),$("#chatbox").css("display","none"))}function scrollBottom(){let e=document.getElementsByClassName("chat-messages")[0];console.log(e),e.scrollTop=e.scrollHeight}function tempClass(e){$("#roomlist > div").removeClass("temporary-highlight"),$(`#friend-${e}`).addClass("temporary-highlight")}socket.on("receive_message",(function(e){console.log("Message Received",e);let s=$(`#chat-messages-list-${currentChatRoom}`);console.log(s),e.user_email===userMail?(console.log("self user"),s.append(`\n        <div class="message-box-holder">\n          <div class="message-box">\n             ${e.message}\n          </div>\n        </div>\n        `)):s.append(`\n    <div class="message-box-holder">\n        <div class="message-sender">\n            ${otherUser.name}\n        </div>\n        <div class="message-box message-partner">\n            ${e.message}\n        </div>\n    </div>\n    `),scrollBottom()})),$(".message-btn").each((function(){console.log("#message-btn"),$(this).click((function(){$("#chatbox").css("display","flex"),console.log($(this),"clicked");const e=$(this).attr("data-friendId");$.ajax({type:"GET",url:`/messages/chatroom?friend=${e}`,success:function(e){let{chatRoom:s,friend:n,user:o}=e.data,a=createArea(s,n,o);chatArea.empty(),$("#chatbox").append(a),scrollBottom(),selfUser=o,otherUser=n,currentChatRoom=s._id,userMail=o.email,connectRoom()},error:function(e){console.log(e.responseText)}})}))}));